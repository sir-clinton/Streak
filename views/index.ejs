<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title><%= meta?.title || 'Raha.com – Find Your Vibe' %></title>
    <meta name="description" content="<%= meta?.description || 'Discover local companions for chill days and hype nights.' %>">
    <!-- Open Graph Tags -->
    <meta property="og:title" content="<%= meta?.title || 'Raha.com – Find Your Vibe' %>" />
    <meta property="og:description" content="<%= meta?.description || 'Discover local companions for chill days and hype nights.' %>" />
    <meta property="og:image" content="<%= meta?.image %>" />
    <meta property="og:url" content="<%= meta?.url %>" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:title" content="<%= meta?.title %>" />
    <meta name="twitter:description" content="<%= meta?.description %>" />
    <meta name="twitter:image" content="<%= meta?.image %>" />
    <meta name="twitter:card" content="summary_large_image" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.cdnfonts.com/css/satoshi?display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"> -->
    <!-- ✅ Preload critical CSS -->
    <link rel="preload" href="/css/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/css/styles.css"></noscript>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
    <style>
       .escort-name {
            margin: 0;
            padding: 4px 0;
            font-size: 1rem;
            }html,body{
                display: flex;
                flex-direction: column;
                min-height:100vh;
            }main .listings .call:hover i {
                color: #fff;
            }.modal {
  display: none;
  align-items: center;
  justify-content: center;
  position: fixed;
  z-index: 999;
  inset: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}

.modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border-radius: 8px;
  width: 90%;
  max-width: 600px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.close-btn {
  float: right;
  font-size: 1.5rem;
  cursor: pointer;
  color: #333;
}
#openBookmarkModal {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 56px;
  height: 56px;
  background-color: #25D366; /* WhatsApp green */
  color: #fff;
  border-radius: 50%;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 22px;
  cursor: pointer;
  transition: box-shadow 0.2s ease, transform 0.2s ease;
  z-index: 999;
}

#openBookmarkModal:hover {
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35);
  transform: scale(1.05);
}
@keyframes floatUp {
  0% { transform: translateY(40px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}

#openBookmarkModal {
  animation: floatUp 0.4s ease-out;
}@media (min-width: 800px){
  .fa-bookmark{
    display: none;
  }
}
    </style>
</head>
<body>
    <div class="container">
        <%- include('partials/header')  %>
        <!-- hero section -->
         <section id="hero-section">
            <h1>Find Your Vibe</h1>
            <p>Escorts companions for your chill days, hype nights, and everything in </p><p>between.</p>
            <div class="filter">
                <label for="gender">Filter By</label><br><br>
                <form id="filter-form" onsubmit="submitForm(event)" method="GET">
                    <select id="gender" name="gender" aria-label="Gender filter">
                        <option value="Select Gender" disabled selected hidden>Select Gender</option>
                        <option value="Female">Female</option>
                        <option value="Male">Male</option>
                        <option value="Transexual">Transexual</option>
                    </select>
                    <select id="city" name="city" aria-label="City filter">
                      <option value="Select City" disabled selected hidden>Select City</option>
                      <option value="Nairobi">Nairobi</option>
                      <!-- <option value="Mombasa">Mombasa</option> -->
                      <option value="Kiambu">Kiambu</option>
                      <!-- <option value="Nakuru">Nakuru</option>
                      <option value="Kisumu">Kisumu</option>
                      <option value="Eldoret">Eldoret</option>
                      <option value="Machakos">Machakos</option>
                      <option value="Laikipia">Laikipia</option>
                      <option value="Kajiado">Kajiado</option>
                      <option value="Kilifi">Kilifi</option>
                      <option value="Uasin Gishu">Uasin Gishu</option>
                      <option value="Kisii">Kisii</option>
                      <option value="Kakamega">Kakamega</option> -->
                    </select>
                    <button aria-label="filter button" id='submit' type="submit">Filter</button>
                </form>
            </div>
         </section>

         <section id="main" class="main">
            <div class="listings" id="listings" style="position: relative">
                <% if(escorts.length ===  0){ %>
                    <p style="position: absolute; top:50%; left: 50%; transform: translateX(-50%)">Please check back soon!
                    </p>
                    <% } %>
                 <% escorts.forEach(escort => {  %>
                    <a href='/author/<%= escort.name%>' class="card" style="display: flex;" data-id="<%= escort._id %>">
                    <% if (escort.isBoosted) { %>
                    <div class="badge <%= escort.boostType %>">
                        <%= escort.boostType %>
                    </div>
                    <% } %>
                <div class="image-wrapper">
                    <img loading="lazy" width="200" height="200" src="<%= escort.userImg%>" alt="<%= escort.name%>">
                </div>
                <div class="info">
                    <p class="escort-name"><%= escort.name.split(' ')[0]%></p>
                    <span aria-label="Bookmark profile"><i title="Bookmark this profile" class="fa-solid fa-bookmark bookmark-btn" data-id="<%= escort._id %>" data-name="<%= escort.name %>" data-img="<%= escort.userImg %>" style="color: #444" aria-hidden="true"></i></span>

                    <!-- <p><i class="fa-solid fa-location-dot" style="color: #6c757d;"></i> Kware.</p> -->
                </div><hr>
                <p style="padding: 4px;color: #6c757d;">Meet <%= escort.name.split(' ')[0]%> a <%= escort.age %> years old <%= escort.gender%> Escort from <%= escort.city%>, <%= escort.location %> area.</p>
                <div class="call">
                CALL <%= escort.name.split(' ')[0].toUpperCase() %>
                &nbsp;<i class="fa fa-phone"></i>
                </div>

            </a>
                <% });%>
        </div>     
        </section>
    </div>

    <div id="bookmarkModal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3>Your Bookmarked Escorts</h3>
    <div id="bookmarkedList"></div>
  </div>
</div>
<i class="fa-solid fa-bookmark" id="openBookmarkModal" title="Saved Profiles"></span></i>


     <%- include('partials/footer')  %>
    <script defer>
    document.addEventListener('DOMContentLoaded', () => {
  // Code to set up your UI goes here
   // JavaScript
     let prefferedOption = localStorage.getItem('prefferedOption')
    ? JSON.parse(localStorage.getItem('prefferedOption'))
    : {city: 'Nairobi', gender: 'Female'};
  
     document.getElementById('gender').value = prefferedOption.gender
     document.getElementById('city').value = prefferedOption.city;
     const form = document.querySelector('#filter-form');
   

        // const form = document.getElementById('filter-form');
        // const gender = document.getElementById('gender');
        // const city   = document.getElementById('city');
        // const listings = document.querySelector('.listings');
        form.addEventListener('submit', submitForm);
        
        function submitForm(e) {  
            // if (typeof window === 'undefined') return;
            e.preventDefault();
            const gender = document.getElementById('gender').value;
            const city = document.getElementById('city').value;

            if (!gender || !city || gender === 'Select Gender' || city === 'Select City') return;
                localStorage.setItem('prefferedOption', JSON.stringify({city, gender}));

            window.location.href = `/city/${encodeURIComponent(city)}?gender=${encodeURIComponent(gender)}`;
        
        }


  document.querySelectorAll('.bookmark-btn').forEach(icon => {
  icon.addEventListener('click', (e) => {
    e.preventDefault();
    const id = icon.dataset.id;
    const name = icon.dataset.name;
    const img = icon.dataset.img;

    const bookmarks = JSON.parse(localStorage.getItem('bookmarkedEscorts')) || []; // ✅ Fresh copy per click
    const isAlreadyBookmarked = bookmarks.some(item => item.id === id);

    if (!isAlreadyBookmarked) {
      bookmarks.push({ id, name, img });
      localStorage.setItem('bookmarkedEscorts', JSON.stringify(bookmarks));
      icon.style.color = '#25D366'; // Green
    } else {
      const updated = bookmarks.filter(item => item.id !== id);
      localStorage.setItem('bookmarkedEscorts', JSON.stringify(updated));
      icon.style.color = '#444'; // Grey
    }
  });
});

  // Show modal trigger (e.g. icon, button)
document.getElementById('openBookmarkModal').addEventListener('click', () => {
  const modal = document.getElementById('bookmarkModal');
  const list = document.getElementById('bookmarkedList');
  const bookmarks = JSON.parse(localStorage.getItem('bookmarkedEscorts')) || [];

 list.innerHTML = bookmarks.length === 0 ? 
  "<p>No bookmarks yet.</p>" : 
  bookmarks.map(item => `
    <div style="margin-bottom: 12px; display: flex; align-items: center;">
      <img src="${item.img}" alt="${item.name}" width="60" style="border-radius:5px;">
      <span style="margin-left:8px; flex: 1;">${item.name}</span>
      <button class="remove-bookmark" data-id="${item.id}" style="background: none; border: none; color: #c0392b; cursor: pointer;">✕</button>
    </div>
  `).join('');
  document.querySelectorAll('.remove-bookmark').forEach(btn => {
  btn.addEventListener('click', () => {
    const id = btn.dataset.id;
    const bookmarks = JSON.parse(localStorage.getItem('bookmarkedEscorts')) || []; // ✅ fresh copy
    const updatedBookmarks = bookmarks.filter(item => item.id !== id);
    localStorage.setItem('bookmarkedEscorts', JSON.stringify(updatedBookmarks));
    btn.parentElement.remove();

    if (updatedBookmarks.length === 0) {
      document.getElementById('bookmarkModal').style.display = 'none';
    }
  });
});

  modal.style.display = "flex";
});


// Close modal
document.querySelector('.close-btn').onclick = function () {
  document.getElementById('bookmarkModal').style.display = "none";
};

// Close on outside click
window.onclick = function(event) {
  const modal = document.getElementById('bookmarkModal');
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

  
});

    
 </script>
 <script defer type="application/ld+json">
  <%= JSON.stringify({
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": meta?.title,
  "description": meta?.description,
  "image": meta?.image,
  "address": {
    "@type": "PostalAddress",
    "addressLocality": city,
    "addressCountry": "KE"
  },
  "url": meta?.url
}) %>
 </script>
    <script defer type='module' src="/js/script.js"></script>
</body>
</html>
